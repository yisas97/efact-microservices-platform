#!/bin/sh
set -e

vault server -dev -dev-root-token-id=efact-root-token-dev-only &
VAULT_PID=$!

export VAULT_ADDR='http://localhost:8200'
export VAULT_TOKEN='efact-root-token-dev-only'
sleep 5

echo "Cargando secrets..."

vault kv put secret/efact/ms2/rsa-keys/local \
  private_key="MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCxGCwo7b4XSmX/WKjqMvayfVYO/HovL58oEbikN7u4lxMuYZi67DNI9QJIyMrQ/jmPU1KqgprjhQY6aBBqNdsRal2NdGCaIKXsNjXol9YWxBOOSiM/Ma1tRGvJWdGjU2r3U0CIyKfg+6xHICUsh4EI1b6Bvb3vJLznVkIOchgeky5CqnubI3fQnJ8nGLjsqWETuBb0SPDgbXN+sBa3B0OJtoWJINKDK3jVjArkBTEOH6SfzuWbldHq6rjDB2YyR7F7IH4xYhZPd7e5xcq2vWxgBNJRFNG2Kv4qLjIdGR5O2TvlkDQDUUv73WcwNVQy1CPUOnEwoNZF7oSdEJSTrn5TAgMBAAECggEAEQMA7veTjJo1fRdvtnupzhCTLUJcnF7HO6qkIYZHDp7YlVqDuOUKsiXzD7nWHchmEBoRdVaxeUykggTQGtvMjPo6PWXiB7w+JBg7CnpXcv1n4YHGrAHiJn5tmjx6EmXnfxWsu9cGpWqXrIduer4Ti504vS7UaX4OdWyIUOnt3jXc0tJNqBMQHpPzLzkOkA3n2EwFxMwOQLH9YIqhQz9wSVbgxZSbDU4KWjcV1u91XUouryrLvlhlSmJsH/tBVmOnqGK+SBVHUrckm8Wwr802qg/MDrbRonzjLbooRl2sQYFuEo1qjyi0CAX7VruC+Oa38PT7ZndzTqlwVD+wJpYlFQKBgQC2Ou4/xcxEZHm68t6P25YDqVVNgtVu3Gl8vTwuqN4+g1tqPKGQcjiuUEtPGRarOdYqKJZTQJSVbpcBTxivxhDt0YqXmtg6/34XW1koaSluOLbejf7Vn6rcvi0aQdZeAZcVz48B9UBQ8ovOVQDFApI+QonbE+i2o+4tHUfGHxhOtwKBgQD4yQGGqPeh9jAJGXsW0wtG4SZ/+IDdLJFj5YBGudsLikNat0khApHnHgJ0WGO5dl8nQMXSVaGroRQeJ1ORC/E6HWu+6DWqbz9AFHwwi8HiKmBOoA8T9ysDnEylkch4POyb4+MEsPScGN9GpTWrVN4X7J4XD0kuXnLPrIOZuTHxRQKBgAiMJxSysGwc0mDkd3AD+rtdO/UQx/YVPJVvQt1laldATg9jnKhr0yDJ/15MbPXHFraPhM2O3+lKcKbNEPldrvmYtIl759yMk1uBG2N720eiPWGfA279uEP2X6M1p1ptdKq/O5P57vRdDBW3gvu6rSVidZjjDC1U7x0KnI08dCVtAoGBAO6KHJJ3NGjw2oH/EoyB8pAVlYqiRTzMXONBzEsELUjVW1uB3fZutmK53XScw5GyM+45JvRT8t3TZqy63F946eTlDMhRchNm82iHu8P4XQBzzT/WLF7iYTXnCX6/V04ibGPUj3mSChgZqQvdoKYUi5a446QMngh9uuvw54XfkklZAoGAS6ESk8jMKHZgARz3ckhHqUH9g0d/pHbOZU7OJPPR2VqasZCqD5crS6OfsD8/PE1hHaDZTd7CqRtwhjOwWnrX+kvgaIbdroYR1h4HfXjJ3cgciUiz8mM43PlaPUElhzLS/GOrOp18fhVw4UQVEY/ZA/0IWqDFoTyfom3XdLpSUDA=" \
  public_key="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsRgsKO2+F0pl/1io6jL2sn1WDvx6Ly+fKBG4pDe7uJcTLmGYuuwzSPUCSMjK0P45j1NSqoKa44UGOmgQajXbEWpdjXRgmiCl7DY16JfWFsQTjkojPzGtbURryVnRo1Nq91NAiMin4PusRyAlLIeBCNW+gb297yS851ZCDnIYHpMuQqp7myN30JyfJxi47KlhE7gW9Ejw4G1zfrAWtwdDibaFiSDSgyt41YwK5AUxDh+kn87lm5XR6uq4wwdmMkexeyB+MWIWT3e3ucXKtr1sYATSURTRtir+Ki4yHRkeTtk75ZA0A1FL+91nMDVUMtQj1DpxMKDWRe6EnRCUk65+UwIDAQAB" \
  key_size="2048" \
  algorithm="RSA" \
  environment="local" > /dev/null

vault kv put secret/efact/ms2/rsa-keys/qa \
  private_key="MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDUb8yKlpOeUkWcoP95sEP4xFb6Axa6WjsblPdAwzqdp3XbyQC8O7+ED1zaAOLj0BVQFZZZM/vbYGC2jkPGu6wjYYkPqzOpXRyej5duiU7N5hIDsMwargmdU/8E5lnqYRZMRJ4tEKp6qok6Hqdcg1J+8ILSWB8mPnGcMszPiqixLRLgUq2Kf/T+iH7YHB5UjUM74OWyGikhzv/KzZSx8FYWMh/tT7DCNo/PT3qj0HZYAOUgts8WdmVi+Oc89Ftuzw8wfMQpXT/s5nhOJZJ54zNdr3fTSdA5Tur7h9/PF5b3p9dXw2yxHtXXqE3697536bazdB2J2U717ZOblnq8m5TdAgMBAAECggEAFHruFw2lj/WyNK5IIu+theNL1/uJ6o+os3kyOGykjy67S+PowxI8MvDrjIWEWjPP3NzP61akeRr6spmBiucXP9ah3kBXkS7jA52n8DtNknJpRIYmueBobeH7VnoXVg4Oa8ORFPAj4gKPNeq0S3906bxUfbngJZGPO2Cht9Ule+XFt+phuSe3yB3wEJyQu1IIXoQO1Oc60sdze0UMKexegfZqdbMD74PUFJY303S7zGkaJ6U+DDhPOuCsGJ+TV46Mt3RKfpoI8FcNctRB++VQtI8IXi9S6PKulOxw6Y0ZbglhP+M5oBpBBbld1acHqY6lMLv1gSap+/EhJafP5CoG4wKBgQDiP55PjhZmcaOyEIIqsWvbuZXDdopkniqHdk41KhDMF8iLil1GJUjdqaUb+SxIQVXYef21G90IePzKMW2DlFDfKfNwKBHos6eusFEWnzA2XSk/mFULPl971o5YwgxFx+tU/y3+bpjFJQ6z0Ly1LCVmTQ8mp/ROJueiey0FDi4DiwKBgQDwXzko1pkL7UAX4nyRphyB6UliVXaysVJ9zD2mFmF2i5Enyxs/GGkAhqrONmms1Hxj4+HsIKGObtq1FXr/8pCnG6ceJbnB8lGW+v/u+u7ExJ9Gu9RiiYqtkKTTCv2mWZeuHW9iOelnXCcFfWZDWtcy70kSTwXuoBJX9OrdpRy2NwKBgGgOloNEeGz5iy5UhWmZXGAchRL3LEOGs0zGTsYI6NzVe3kiVC/06gR5B+VLvuAknJUJ1nQ7snc5HhrojNPdnSxmoP5Oj54VMuQXV9QttwDp7BTBvSuErmnIjoOoC/j0L/pRuxewSjcyCgcN1B0HhtP8USGYUba4EgUa3ePbV7JtAoGBAJw+yYDqPYGrLkZYSnDCcTVg1vq8YvO0n9J1uH0Ff0T3Y9tiAsv4qghVgSGZ7QcS9+hWcLx0WY+kLzYWSGWm3rBBIVhPXXfcc3yYm1RUeHAe/wmTfnKuxR4dL4afVlGTWy0qpQRMcJNnK1Y+NQMDQW8ya2UjSM/b7RCPezun4AnxAoGACyp8TTT/xd/jYrancGnNuywyQZKdCoe71fWsaid9dyBFEIVBkloZnKLTxbKM0lF770dnhObFL4GEivCpnwfS2tEgHA+L2EDaQtRyPA3DbE2YfJsGjpuQjx9cVfcuwmexsXx1MPs7/+WH+zZ6+T3XDpWoDOBAm3YwK5Adkv31oOY=" \
  public_key="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1G/MipaTnlJFnKD/ebBD+MRW+gMWulo7G5T3QMM6nad128kAvDu/hA9c2gDi49AVUBWWWTP722Bgto5DxrusI2GJD6szqV0cno+XbolOzeYSA7DMGq4JnVP/BOZZ6mEWTESeLRCqeqqJOh6nXINSfvCC0lgfJj5xnDLMz4qosS0S4FKtin/0/oh+2BweVI1DO+DlshopIc7/ys2UsfBWFjIf7U+wwjaPz096o9B2WADlILbPFnZlYvjnPPRbbs8PMHzEKV0/7OZ4TiWSeeMzXa9300nQOU7q+4ffzxeW96fXV8NssR7V16hN+ve+d+m2s3QdidlO9e2Tm5Z6vJuU3QIDAQAB" \
  key_size="2048" \
  algorithm="RSA" \
  environment="qa" > /dev/null

vault kv put secret/efact/ms2/rsa-keys/prod \
  private_key="MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDUb8yKlpOeUkWcoP95sEP4xFb6Axa6WjsblPdAwzqdp3XbyQC8O7+ED1zaAOLj0BVQFZZZM/vbYGC2jkPGu6wjYYkPqzOpXRyej5duiU7N5hIDsMwargmdU/8E5lnqYRZMRJ4tEKp6qok6Hqdcg1J+8ILSWB8mPnGcMszPiqixLRLgUq2Kf/T+iH7YHB5UjUM74OWyGikhzv/KzZSx8FYWMh/tT7DCNo/PT3qj0HZYAOUgts8WdmVi+Oc89Ftuzw8wfMQpXT/s5nhOJZJ54zNdr3fTSdA5Tur7h9/PF5b3p9dXw2yxHtXXqE3697536bazdB2J2U717ZOblnq8m5TdAgMBAAECggEAFHruFw2lj/WyNK5IIu+theNL1/uJ6o+os3kyOGykjy67S+PowxI8MvDrjIWEWjPP3NzP61akeRr6spmBiucXP9ah3kBXkS7jA52n8DtNknJpRIYmueBobeH7VnoXVg4Oa8ORFPAj4gKPNeq0S3906bxUfbngJZGPO2Cht9Ule+XFt+phuSe3yB3wEJyQu1IIXoQO1Oc60sdze0UMKexegfZqdbMD74PUFJY303S7zGkaJ6U+DDhPOuCsGJ+TV46Mt3RKfpoI8FcNctRB++VQtI8IXi9S6PKulOxw6Y0ZbglhP+M5oBpBBbld1acHqY6lMLv1gSap+/EhJafP5CoG4wKBgQDiP55PjhZmcaOyEIIqsWvbuZXDdopkniqHdk41KhDMF8iLil1GJUjdqaUb+SxIQVXYef21G90IePzKMW2DlFDfKfNwKBHos6eusFEWnzA2XSk/mFULPl971o5YwgxFx+tU/y3+bpjFJQ6z0Ly1LCVmTQ8mp/ROJueiey0FDi4DiwKBgQDwXzko1pkL7UAX4nyRphyB6UliVXaysVJ9zD2mFmF2i5Enyxs/GGkAhqrONmms1Hxj4+HsIKGObtq1FXr/8pCnG6ceJbnB8lGW+v/u+u7ExJ9Gu9RiiYqtkKTTCv2mWZeuHW9iOelnXCcFfWZDWtcy70kSTwXuoBJX9OrdpRy2NwKBgGgOloNEeGz5iy5UhWmZXGAchRL3LEOGs0zGTsYI6NzVe3kiVC/06gR5B+VLvuAknJUJ1nQ7snc5HhrojNPdnSxmoP5Oj54VMuQXV9QttwDp7BTBvSuErmnIjoOoC/j0L/pRuxewSjcyCgcN1B0HhtP8USGYUba4EgUa3ePbV7JtAoGBAJw+yYDqPYGrLkZYSnDCcTVg1vq8YvO0n9J1uH0Ff0T3Y9tiAsv4qghVgSGZ7QcS9+hWcLx0WY+kLzYWSGWm3rBBIVhPXXfcc3yYm1RUeHAe/wmTfnKuxR4dL4afVlGTWy0qpQRMcJNnK1Y+NQMDQW8ya2UjSM/b7RCPezun4AnxAoGACyp8TTT/xd/jYrancGnNuywyQZKdCoe71fWsaid9dyBFEIVBkloZnKLTxbKM0lF770dnhObFL4GEivCpnwfS2tEgHA+L2EDaQtRyPA3DbE2YfJsGjpuQjx9cVfcuwmexsXx1MPs7/+WH+zZ6+T3XDpWoDOBAm3YwK5Adkv31oOY=" \
  public_key="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1G/MipaTnlJFnKD/ebBD+MRW+gMWulo7G5T3QMM6nad128kAvDu/hA9c2gDi49AVUBWWWTP722Bgto5DxrusI2GJD6szqV0cno+XbolOzeYSA7DMGq4JnVP/BOZZ6mEWTESeLRCqeqqJOh6nXINSfvCC0lgfJj5xnDLMz4qosS0S4FKtin/0/oh+2BweVI1DO+DlshopIc7/ys2UsfBWFjIf7U+wwjaPz096o9B2WADlILbPFnZlYvjnPPRbbs8PMHzEKV0/7OZ4TiWSeeMzXa9300nQOU7q+4ffzxeW96fXV8NssR7V16hN+ve+d+m2s3QdidlO9e2Tm5Z6vJuU3QIDAQAB" \
  key_size="2048" \
  algorithm="RSA" \
  environment="prod" > /dev/null

echo "Secrets cargados"

wait $VAULT_PID
